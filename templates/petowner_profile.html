<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pet Profile Page</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Background shapes -->
    <div class="bg-shape bg-shape-1"></div>
    <div class="bg-shape bg-shape-2"></div>
    
    <div class="pet-page">
        <header>
            <nav class="navbar">
                <div class="logo">
                    <div class="logo-icon"></div>
                    Elanco
                </div>
                <div class="nav-links">
                    <a href="{{ url_for('default') }}">Home</a>
                    <a href="{{ url_for('dashboard') }}">Dashboard</a>
                    <a href="{{ url_for('pets') }}">My Pets</a>
                    <a href="{{ url_for('petliveactivity') }}">Live Activity</a>
                    <a href="{{ url_for('petpageanalysis') }}">All Pets Analysis</a>
                    <a href="{{ url_for('login') }}" class="login-link">Logout</a>
                </div>
            </nav>
        </header>

        <!-- Pet Owner Profile Section -->
        <main>
            <center>
            <h1 class="profile-title">Pet Owner Profile</h1>
            </center>
        <div class="chart-row">
            <div class="chart-container">
                <h2>Pet Activity Over the Week</h2>
                <canvas id="petChart"></canvas>
            </div>
        
            <!-- Container for Pie Chart -->
            <div class="chart-container">
                <h4>Pet Activity Breakdown</h4>
                <label for="daySelector">Select a Day:</label>
                <select id="daySelector">
                    <option value="0">Monday</option>
                    <option value="1">Tuesday</option>
                    <option value="2">Wednesday</option>
                    <option value="3">Thursday</option>
                    <option value="4">Friday</option>
                    <option value="5">Saturday</option>
                    <option value="6">Sunday</option>
                </select>
                <canvas id="activityPieChart"></canvas>
            </div>
        </div>
        <div class="chart-row">
            <!-- Line Chart for Pet's Weight -->
            <div class="chart-container">
                <h3>Pet Weight Over the Week</h3>
                <canvas id="weightChart"></canvas>
            </div>
            <!-- Line Chart for Pet's Temperature -->
            <div class="chart-container">
                <h4>Pet Temperature Throughout the Day</h4>
                <canvas id="tempChart"></canvas>
            </div>
        </div>
        <div class="chart-row">
            <!-- Line Chart for Pet's Exercise Levels -->
            <div class="chart-container">
                <h5>Pet Exercise Levels (Steps per Day)</h5>
                <canvas id="exerciseChart"></canvas>
            </div>
            <!-- Line Chart for Pet's Sleep Patterns -->
            <div class="chart-container">
                <h6>Pet Sleep Patterns (Hours Slept Per Day)</h6>
                <canvas id="sleepChart"></canvas>
            </div>
        </div>
        <div style="text-align: center; margin: 40px 0;">
            <a href="{{ url_for('petpageanalysis') }}" class="cta-button">View All Pets Analysis</a>
        </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const ctx = document.getElementById("petChart").getContext("2d");
        const lineChartCanvas = document.getElementById("weightChart").getContext("2d");
        const tempChartCanvas = document.getElementById("tempChart").getContext("2d");
        const exerciseChartCanvas = document.getElementById("exerciseChart").getContext("2d");
        const sleepChartCanvas = document.getElementById("sleepChart").getContext("2d");
        const pieChartCanvas = document.getElementById("activityPieChart").getContext("2d");
        const daySelector = document.getElementById("daySelector");
    
        const data = {
            labels: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
            datasets: [
                { label: "Sleeping", data: [12, 9, 17, 4, 10, 16, 11], backgroundColor: "red" },
                { label: "Eating", data: [3, 6, 4, 2, 8, 5, 4], backgroundColor: "orange" },
                { label: "Playing", data: [3, 4, 1, 4, 2, 2, 5], backgroundColor: "green" },
                { label: "Roaming", data: [6, 5, 2, 14, 4, 1, 4], backgroundColor: "yellow" },
            ],
        };
    
        new Chart(ctx, {
            type: "bar",
            data: data,
            options: {
                indexAxis: "y",
                scales: {
                    x: { beginAtZero: true, max: 24, ticks: { stepSize: 5 } },
                },
            },
        });
    
        // Line Chart Data (Weight over the week)
        const lineChartData = {
            labels: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
            datasets: [
                {
                    label: "Pet Weight (kg)",
                    data: [10.2, 10.3, 10.25, 10.4, 10.35, 10.5, 10.55],
                    borderColor: "blue",
                    backgroundColor: "rgba(0, 0, 255, 0.1)",
                    fill: true,
                    tension: 0.3,
                },
            ],
        };
    
        new Chart(lineChartCanvas, {
            type: "line",
            data: lineChartData,
            options: {
                scales: {
                    y: { beginAtZero: false, min: 10, max: 11 },
                },
            },
        });
    
        // ** FIXED: Temperature Chart is now INSIDE this function **
        const tempChartData = {
            labels: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
            datasets: [
                {
                    label: "Average Pet Temperature (Â°C)",
                    data: [37.5, 37.8, 38.2, 37.9, 38.1, 38.0, 37.6], // Mocked data
                    borderColor: "red",
                    backgroundColor: "rgba(255, 0, 0, 0.1)",
                    fill: true,
                    tension: 0.3,
                },
            ],
        };
    
        new Chart(tempChartCanvas, {
            type: "line",
            data: tempChartData,
            options: {
                scales: {
                    y: { beginAtZero: false, min: 36, max: 40 },
                },
            },
        });


    // Mocked Data for Exercise Levels
    const exerciseChartData = {
            labels: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
            datasets: [
                {
                    label: "Steps Taken",
                    data: [3500, 4200, 5000, 3200, 6100, 7000, 4800], 
                    borderColor: "green",
                    backgroundColor: "rgba(0, 128, 0, 0.1)",
                    fill: true,
                    tension: 0.3,
                },
            ],
        };

        // Create the Line Chart
        new Chart(exerciseChartCanvas, {
            type: "line",
            data: exerciseChartData,
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        min: 0,
                        max: 8000, 
                    },
                },
            },
        });

    // Mocked Data for Sleep Patterns
    const sleepChartData = {
            labels: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
            datasets: [
                {
                    label: "Hours Slept",
                    data: [12, 10, 14, 8, 11, 13, 15], 
                    borderColor: "purple",
                    backgroundColor: "rgba(128, 0, 128, 0.1)",
                    fill: true,
                    tension: 0.3,
                },
            ],
        };

        // Create the Line Chart
        new Chart(sleepChartCanvas, {
            type: "line",
            data: sleepChartData,
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        min: 6,
                        max: 16, 
                    },
                },
            },
        });
    // Pet activity data (same structure as bar chart)
    const petActivityData = {
        labels: ["Sleeping", "Eating", "Playing", "Roaming"],
        datasets: [
            [12, 3, 3, 6], // Monday
            [9, 6, 4, 5],  // Tuesday
            [17, 4, 1, 2], // Wednesday
            [4, 2, 4, 14], // Thursday
            [10, 8, 2, 4], // Friday
            [16, 5, 2, 1], // Saturday
            [11, 4, 5, 4]  // Sunday
        ]
    };

    // Create initial Pie Chart
    let pieChart = new Chart(pieChartCanvas, {
        type: "pie",
        data: {
            labels: petActivityData.labels,
            datasets: [{
                data: petActivityData.datasets[0], // Default to Monday
                backgroundColor: ["red", "orange", "green", "yellow"],
            }]
        }
    });

    // Update Pie Chart when user selects a different day
    daySelector.addEventListener("change", function () {
        let selectedDay = parseInt(daySelector.value);
        pieChart.data.datasets[0].data = petActivityData.datasets[selectedDay];
        pieChart.update();
    });
});
    </script>

{% if pets %}
<div id="pets-container">
    <button class="cta-button"
            onclick="document.getElementById('pet-modal').style.display='block';">
        Add Another Pet
    </button>
    <div class="pets-list">
        {% for pet in pets %}
        <div class="pet-card">
            <img src="{{ pet.image or url_for('static', filename='default-pet-image.jpg') }}" alt="{{ pet.name }}">
            <h3>{{ pet.name }}</h3>
            <p>{{ pet.animal_type }} - {{ pet.breed }}</p>
            <button class="cta-button"
                    onclick="editPet('{{ pet.id }}', '{{ pet.name }}', '{{ pet.animal_type }}', '{{ pet.breed }}', '{{ pet.age }}', '{{ pet.height }}', '{{ pet.weight }}', '{{ pet.last_vet_visit }}');">
                Edit
            </button>
            <button class="cta-button delete-button"
                    onclick="confirmDelete('{{ pet.id }}');">
                Delete
            </button>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
</html>
